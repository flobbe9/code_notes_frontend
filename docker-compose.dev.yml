services:
  frontend:
    image: dev_${API_NAME}
    container_name: frontend
    build: 
      context: .
      args:
        NODE_VERSION: ${NODE_VERSION}
        HTTPS: false
        PORT: 3000
    # NOTE: this does not override application .env vars
    environment:
      SSL_KEY_FILE_PASSWORD: password
      TZ: ${TZ}
    ports: 
      - 3000:3000
      # for testing ssl
      - 443:443
    # UNCOMMENT: to use NODE_ENV=development
    # entrypoint: npm start 
    healthcheck:
      test: wget --no-verbose --no-check-certificate --tries=1 --spider http://frontend:3000 || exit 1
      interval: 5s
      timeout: 10s
      retries: 5
    restart: on-failure
    volumes:
      - ./.nginx.local/nginx.local.conf:/etc/nginx/conf.d/default.conf
      - ./.nginx.local/ssl/localhost.crt.pem:/etc/nginx/conf.d/localhost.crt.pem
      - ./.nginx.local/ssl/localhost.key.pem:/etc/nginx/conf.d/localhost.key.pem